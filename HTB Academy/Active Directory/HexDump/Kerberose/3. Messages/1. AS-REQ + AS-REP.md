This is the first request/response that is sent.

The purpose of this exchange is to obtain a `Ticket Granting Ticket` (TGT).

Entities involved:
  - Client
  - AS/KDC

Messages:
  - AS-REQ (Authentication Service Request), Client -> AS
  - AS-REP (Authentication Service Reply), AS -> Client

---
# AS-REQ

## The AS-REQ can contain 

`pre-authentication data`, such as:

### PA-PAC-REQUEST

Specifies if the user wants to obtain a TGT that includes `PAC` data (Privileged Attribute Certificate), containg authorization information like group memberships and user privileges.

### PA-ENC-TIMESTAMP

It contains a timestamp encrypted with the user's key. It is used to prove that the request comes from the legitimate user, and it is also used to prevent replay attacks.
When the KDC/AS receives the timestamp, it uses the user's secret key to decrypt the timestamp. If the timestamp is within an *acceptable window of time*, authentication proceeds. Otherwise, it fails.


---

## During this authentication different errors can happen, such as:

### KRB5KDC_ERR_PREAUTH_REQUIRED

The client must include proper authentication data.

### KRB5KRB_AP_ERR_SKEW

Since Kerberos relies on syncrhonized clocks for security, significant time different between entities can result in a `time skew error`.

### eRR-PREAUTH-FAILED

When the timestamp is not properly encrypted with the user private key. This means that the user typed in the wrong password.

  Example of an AS-REQ package
  
```sh
     Kerberos
       Record Mark: 314 bytes
       as-req
       pvno: 5
       msg-type: krb-as-req (10)
       padata: 2 items
       PA-DATA pA-ENC-TIMESTAMP
       padata-type: pA-ENC-TIMESTAMP (2)
       padata-value: 3041a003020112a23a0438739cbf03ee305b1f57e7300c81585ce5bf25c8897d12735870…
       etype: eTYPE-AES256-CTS-HMAC-SHA1-96 (18)
       cipher: 739cbf03ee305b1f57e7300c81585ce5bf25c8897d1273587034a71546327b16c37294c3…
       PA-DATA pA-PAC-REQUEST
       padata-type: pA-PAC-REQUEST (128)
       padata-value: 3005a0030101ff
       include-pac: True
       req-body
```

---

# AS-REP

The AS-RESP contains instead:
- The `TGT` (Ticket Granting Ticket) issued by the KDC/AS. The ticket is encrypted using the `Kerberos Ticket Granting Service` (krbtgt) account key also known as `TGS secret key`.
- The `Encrypted Part`, which contains the TGS session key and other authentication details such as the TGS Name, the timestamp, and the lifetime of the TGS. It is encrypted using the client's long-term key derived from the machine. The client will decrypt the message to obtain the session key.

  Example of an AS-RESP package
```powershell  
 Kerberos
     Record Mark: 1711 bytes
     as-rep
         pvno: 5
         msg-type: krb-as-rep (11)
         padata: 1 item
             PA-DATA pA-ETYPE-INFO2
                 padata-type: pA-ETYPE-INFO2 (19)
                     padata-value: 30353033a003020112a12c1b2a48455844554d502e4c4142686f7374717569636b656d2d…
                         ETYPE-INFO2-ENTRY
                             etype: eTYPE-AES256-CTS-HMAC-SHA1-96 (18)
                             salt: HEXDUMP.LABhostquickem-kfg06sg.hexdump.lab
         crealm: HEXDUMP.LAB
         cname
         ticket
         enc-part
  
```