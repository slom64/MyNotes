This is the third request/response that is sent.

The purpose of this exchange is for a client to establish an authenticated session using the previously obtained `Ticket Granting Service` (TGS) with a specific service.

  Entities involved:
  - Client
  - Service

  Messages:
  - AP-REQ (Authentication Request), Client -> Service
  - AP-REP (Authentication Reply), Service -> Client
  
---
# AP-REQ


  The `AP-REQ' contains:
  - The service ticket (encrypted with the service key)
  - An authenticator (encrypted with the service session key)

  Example of an AP-REQ package
```powershell
 ap-req
     pvno: 5
     msg-type: krb-ap-req (14)
     Padding: 0
     ap-options: 20000000
         0... .... = reserved: False
         .0.. .... = use-session-key: False
         ..1. .... = mutual-required: True
     ticket
         tkt-vno: 5
         realm: HEXDUMP.LAB
         sname
             name-type: kRB5-NT-SRV-INST (2)
             sname-string: 3 items
                 SNameString: ldap
                 SNameString: DC01.hexdump.lab
                 SNameString: hexdump.lab
         enc-part
     authenticator
```

---
# AP-REP
  
When the service receives the AP-REQ, it performs the following actions:
  - Decrypts the service ticket in order to obtain the service session key
  - Uses the service session key to decrypt the authenticator
  - Validates the authenticator data

The `AP-REP` contains:
 - Encrypted timestamp from the client AP-REQ

It is used to implement `mutual authentication`, that is, it allows clients to authenticate the service.

  Example of an AP-REP package
```powershell

 ap-rep
     pvno: 5
     msg-type: krb-ap-rep (15)
     enc-part
```