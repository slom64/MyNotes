
A `Kerberos Principal` is a unique identity to which Kerberos can assign tickets.
Each principal has an associated *secret key*, which is used during the key agreement protocol to provide authentication.

Principals follow a common name structure:
```powershell
primary/instance@REALM
```
- primary:  Identifies the entity.
- Instance: Further qualifies the primary.
- REALM: The Kerberos domain in which the authentication has to take place.

Each principal has an associated *secret key*, which is used during the key agreement protocol to provide authentication.

| User / Service  / Host Principal | Secret Key |
| -------------------------------- | ---------- |
| leo@HEXDUMP.lab                  | secret1    |
| test@HEXDUMP.lab                 | secret2    |


---

# There are different types of principals:

## User Principal

Represents an individual user in the Kerberos realm.  This is also known as *User Principal Name (UPN)*.
```powershell
whoami /upn

leo@hexdump.lab  # --> This is the UPN
```

---
## Service Principal

Represents a service that requires authentication and authorization to be accessed by its clients.
Example of services:
- SMB Service
- SQL Server
- HTTP Server
- LDAP Server

Services need to register proper Service Principal Names (SPNs) within Active Directory. Once this registration has taken place, Kerberos can issue tickets for service access.

---
## Host Principal

Represents a computer in a Kerberos realm.

---

# Commands

### List out all SPNs registed for `DC01`

```powershell
setspn -L DC01

ldap/DC01.hexdump/hexdump.lab
DNS/DC01.hexdump.lab
```

### Set a new SPN for the username `leo`
```powershell
setspn -A <newService> <userName>
setspn -A HTTP/webserver.hexdump.lab leo
setspn -L leo
```