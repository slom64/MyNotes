The `pre-relay` phase focuses on techniques that induce/coerce a client to initiate `NTLM` authentication for a service on a server. Many techniques are used in the `pre-relay` phase, including:
- `AiTM` techniques such as `poisoning` and `spoofing` attacks.
- `Authentication Coercion` attacks.

---
## Poisoning and Spoofing
There are many ways to perform poisoning or spoofing operations to pose as a legitimate network server or redirect traffic. These techniques usually make much noise and are opportunistic because many rely on requests and traffic initiated by the clients.

Windows supports various name resolution processes:
- `DNS`
- `NetBIOS Name Resolution` ( `NBT-NS`)
- `Link-Local Multicast Name Resolution` ( `LLMNR`)
- `Peer Name Resolution` ( `PNR`)
- `Server Network Information Discovery` ( `SNID`)

### LLMNR, NBT-NS, and mDNS Poisoning
In enterprise networks, the use of DNS is usually heavy. However, some organizations don’t configure the DNS perfectly, resulting in some clients using name resolution that standard DNS servers do not resolve (e.g., because of incomplete DNS tables or unavailable servers). System administrators can configure clients to use alternative name resolution protocols in these situations to fill this gap and have more fluent networks. For example, by default, Windows machines are configured to rely on `LLMNR` ( `Local-Link Multicast Name Resolution`) specified in [RFC4795](https://datatracker.ietf.org/doc/html/rfc4795), `NBT-NS` (NetBIOS Name Service), and other operating systems can also use `mDNS` (multicast Domain Name System).

While DNS is a unicast protocol, meaning that a client directly asks a server for a name resolution, the `LLMNR`, `NBT-NS`, and `mDNS` are multicast protocols, meaning that the client will broadcast the network asking if anyone knows the name it’s looking for. So, if we are in that network, we can answer random name resolution requests and redirect the client to our attack host.

The most common tools that we can use for poisoning and spoofing are [Responder](https://github.com/lgandx/Responder) (most commonly used on Linux) and [Inveigh](https://github.com/Kevin-Robertson/Inveigh) (most widely used on Windows). `Responder` is an `LLMNR`, `NBT-NS` and `MDNS` poisoner, with built-in HTTP/SMB/MSSQL/FTP/LDAP rogue authentication server supporting NTLMv1/NTLMv2/LMv2, Extended Security NTLMSSP, and Basic HTTP authentication.

In the below diagram, instead of connecting to `SERVER`, a client mistypes it as `SERVERR`; however, since no DNS record exists for `SERVERR`, Windows, by default, sends broadcast messages to the network via different protocols ( `LLMNR` in this case) asking if anyone know the IP address for `SERVERR`. As attackers, we will abuse these broadcast requests and send poisoned responses using `Responder` to force the client to authenticate against us.

[[Z Assets/Images/Pasted image 20250915011943.jpeg|Open: Pasted image 20250915011943.png]]
![[Z Assets/Images/Pasted image 20250915011943.jpeg]]
