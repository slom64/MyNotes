## Group Policy Objects implementation in Active Directory

In Active Directory, Group Policy Objects are a mechanism allowing to periodically apply a set of configurations on domain objects – users and computers alike. More concretely, a Group Policy Object is implemented as two distinct elements: the Group Policy Container (GPC), and the Group Policy Template (GPT).

The GPC is an LDAP object presenting various attributes providing information related to the GPO – for instance, its name, version, description, and so on. The Fully Qualified Domain Name of the GPC object includes a GUID identifying the GPO; for instance:

`CN={7B7D6B23-26F8-4E4B-AF23-F9B9005167F6},CN=Policies,CN=System,DC=corp,DC=com`

The GPC also exposes a special attribute called **gPCFileSysPath** containing the UNC path of the SMB share on which the GPT is hosted. The GPT is precisely a folder on an SMB share hosting files that describe the configurations to be implemented when applying the GPO. By default, the **gPCFileSysPath** will point to a folder of the **SYSVOL** share on a domain controller, with a path including the GUID associated with the GPO; for instance:

`\\dc.corp.com\SysVol\corp.com\Policies\{7B7D6B23-26F8-4E4B-AF23-F9B9005167F6}`

As a result, when an object applies a GPO, it will first query an LDAP server in order to fetch the GPC. From the retrieved information and according to the **gPCFileSysPath** attribute, it will then connect to the SMB share containing the GPT in order to fetch the configuration files it should apply.

## The gPLink attribute

In Active Directory, in order to make a user or computer object apply a GPO, this GPO should be linked to an Organizational Unit containing said object. Such a link is performed through the **gPLink** attribute, that is exposed by any OU. The attribute references the various Group Policy Objects that should be applied by objects included in the OU, and has the following format.

`[LDAP://cn={EF07D422-28FA-4AA4-AA17-28A45E428571},cn=policies,cn=system,DC=corp,DC=com;0][LDAP://cn={141C0919-2C09-46C4-A714-A4D5978F4947},cn=policies,cn=system,DC=corp,DC=com;0]`

As made apparent in the example above, the **gPLink** attribute is nothing more than an array of elements, each of them representing a Group Policy Object that should be applied by the child objects of an Organizational Unit. Every element consists in the Fully Qualified Domain Name of the GPC for the Group Policy Object. It starts with the GUID associated with said GPO, and ends with the domain FQDN, followed with the `;0` sequence.

When a user or computer object in Active Directory attempts to apply their GPOs, they will parse the **gPLink** attribute of every OU they belong to, and query the GPCs identified by the FQDNs thus retrieved. In the example provided above for instance, the OU would have two GPOs linked to it.



references: https://www.synacktiv.com/en/publications/ounedpy-exploiting-hidden-organizational-units-acl-attack-vectors-in-active-directory